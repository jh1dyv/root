% 5.4.1.DailyBuildWrapper.tex
%	Last update: 2018/09/10 F.Kanehori
%\newpage
\subsubsection{DailyBuildWrapper}
\label{subsubsec:DailyBuildWrapper}

\medskip
\noindent
タスクDailyBuildを実行するためのラッパスクリプト。
関連するスクリプトの変更を確実に反映させるために、
次の2段階でDailyBuildを起動する。

\bigskip
\begin{narrow}
    \framebox[.75\linewidth][l]{\tt{%
	\tt{\begin{tabular}{l}
		> python DailyBuild.py -u \%*\\
		> python DailyBuild.py -U \%*\\
	\end{tabular}}
    }}\hspace{10pt}\small{(Windows)}
\end{narrow}
\smallskip 又は\smallskip
\begin{narrow}
    \framebox[.75\linewidth][l]{\tt{%
	\tt{\begin{tabular}{l}
		> python DailyBuild.py -u \$*\\
		> python DailyBuild.py -U \$*\\
	\end{tabular}}
    }}\hspace{10pt}\small{(unix)}
\end{narrow}

\bigskip
1回目のスクリプト起動ではレポジトリSpringheadの更新のみを行なう。
2回目は更新されたスクリプトの起動であり、
テストレポジトリを新たに作成してテストを実行する。

\medskip
このスクリプトをタスクスケジューラ(unixの場合はcron)に登録することで
タスクDailyBuildを実行する。
登録情報は次のとおり。

\noindent
Windowsの場合(タスクスケジューラの設定内容)\\
\Vskip{-\baselineskip}
\begin{narrow}
    \begin{LocalScope}
    \TableItemIndent=0pt
    \begin{Table}[r][7.5em]{ll}
	\Item{トリガー}{毎日2:02に起動}
	\Item{操作}{プログラムの開始}
	\Item{スクリプト(P)}{%
		\Path{I:/DailyBuild/Springhead/core/test/DailuBuild.bat}}
	\Item{引数}{%
		\tt{-t 14.0 -c Release -p x64}\Cont\\
		\hspace{40pt}\tt{SpringheadTest DailyBuildResult/Result}}
    \end{Table}
    \end{LocalScope}
\end{narrow}

\noindent
unixの場合(\tt{\Path{crontab}}の設定内容):
\begin{narrow}
    \CmndBox{%
	00 04 * * * \it{projdir}/Springhead/core/test/DailyBuild.sh\Cont\\
	\Hskip{60pt}> \it{projdir}/Springhead/core/test/DailyBuild.log 2>\&1
    }
    ここで \it{projdir} ::= \tt{\Path{/home/demo/Project}}

    \medskip
    \bf{注意1}　テストの実行に関わる環境は、\tt{\Path{\it{projdir}/SprEnvDef.sh}}に
    \tt{\Path{/bin/sh}}のコマンドとして設定しておくこと。
    特に、\tt{python}はバージョン\tt{3.0}以上が実行されるようにパスを設定すること。

    \medskip
    {\small\Path{SprEnvDef.sh}の内容(例)
    \CmndBox{%
	\#!/bin/sh\\
	\\
	\# Use python version 3.4.\\
	\#\\
	export PATH="/usr/local/bin:\$PATH"\\
	export SPR_PYTHON=/usr/local/bin/python\\
	\\
	\# Additional include and library path.\\
	\#\\
	export SPR=\$HOME/Project/Springhead\\
	export SPR_DEPENDENCY=\$SPR/dependency\\
	export SPR_EXTLIBS=\$HOME/ExtLibs\\
	\\
	export SPR_BOOST_INC=\$SPR_EXTLIBS/boost-numeric-bindings-R86799\\
	export SPR_GL_INC=\$SPR_DEPENDENCT/src
    }}

    \medskip
    \bf{注意2}　\tt{cron}で実行するにあたっては、
    \begin{enumerate}
	\item \tt{crontab}の記述には絶対パスを使用すること。
	\item Web serverに登録する鍵にはパスフレーズを設定しないこと。
    \end{enumerate}
    が大切である。
\end{narrow}

% end: 5.4.1.DailyBuildWrapper.tex
