% 5.4.3.TestMainGit.tex
%	Last update: 2018/05/22 F.Kanehori
%\newpage
\subsubsection{TestMainGit}
\label{subsubsec:TestMainGit}

\medskip
\ref{subsec:DailyBuildEnvironmentVariable}で示したstep 4.以降を実行するプログラム。

\bigskip
\noindent
起動方法
\CMND{4pt}{python TestMainGit.py [options] test-repository result-repository}{-8pt}

\noindent
options \small{( $^\dagger$はデフォルトを示す)}
\begin{narrow}[20pt]
    \begin{tabular}{ll}
	\tt{-c CONF} & ビルド構成 (\tt{Debug, Release$^\dagger$, Trace})\\
	\tt{-p PLAT} & プラットフォーム (\tt{x86, x64$^\dagger$})\\
	\tt{-t TOOL} & ツールセット (\tt{14.0$^\dagger$})\\
	\tt{-D} & コマンドを表示するだけで実行はしない(dry run)\\
    \end{tabular}
\end{narrow}

\medskip
\noindent
引数
\begin{narrow}[20pt]
    \begin{tabular}{ll}
	\tt{test-repository}	& テストレポジトリ\\
				& 任意のディレクトリでよいが、
				  既存のディレクトリの場合には、\\
				& その内容はすべて破棄される。\\
	\tt{result-repository}	& テスト結果記録用レポジトリ\\
				& 通常\FILE{DailyBuildResult/Result}を指定する。\\
    \end{tabular}
    \small{\begin{tabular}{ll}
	※& これらのディレクトリは、テストを起動するディレクトリから
	    3階層上のディレクトリ\\
	  & (例えば\FILE{top/Springhead/core/test}ならば\FILE{top})からの
	    相対パスで指定すること。
    \end{tabular}}
\end{narrow}

\medskip
\noindent
処理の説明

\begin{enumerate}
  \item	ディレクトリ\TT{core/test/bin}に移動する。
	\medskip

  \item	次のディレクトリに対して\TT{SpringheadTest}(\REF{subsub:}{SpringheadTest})を
	呼び出してテストを実行する。\\
	\begin{tabular}{ll}
	    \tt{<top>/core/src} & Springheadライブラリを作成する\\
	    \tt{<top>/core/src/tests} & ビルドして実行する\\
	    \tt{<top>/core/src/Samples} & ビルドのみ行なう\\
	\end{tabular}\\
	\\
	呼出しコマンドは、\\
	\CMND{0pt}{%
		\hspace{-10pt}
		\begin{tabular}{l}
		    python SpringheadTest.py \CONT\\
		    \hspace{50pt}-p <plat> -c <conf> -t <tool> -C unuse -S\CONT\\
		    \hspace{50pt}<<dir>> result/dailybuild.result
				 dailybuild.control <<section>>\\
		\end{tabular}}
		{0pt}\\
	\medskip
	optionと引数の説明\\
	\begin{tabular}{@{\hspace{20pt}}ll}
	    \tt{<plat>}	   & 起動引数で指定された値\\
	    \tt{<conf>}	   & 起動引数で指定された値\\
	    \tt{<tool>}	   & 起動引数で指定された値\\
	    \tt{-t <tool>} & Windowsの場合のみ指定\\
	    \tt{-C unuse}  & Closed soruceを使用しないことを指定\\
	    \tt{-S}	   & Springheadライブラリ作成時のみ指定
				(テスト結果ファイルを初期化する)\\
	    第1引数	   & テスト対象ディレクトリ
				(\FILE{.}, \FILE{tests}, \FILE{Samples}を順に指定)\\
	    第2引数	   & テスト結果累積ファイル名
				(\tt{-S}指定がなければ追加記録)\\
	    第3引数	   & テスト制御ファイル名\\
	    第4引数	   & テスト制御ファイルセクション名
				(\tt{Windows}または\tt{unix})\\
			   & テスト制御ファイルのどのセクションを対象とするかを指定\\
	\end{tabular}\\
	\medskip

  \item	ディレクトリ\TT{core/test/log}に移動する。
	\medskip

  \item	Springheadの最新コミットIDを調べて、
	ファイル\FILE{Springhead.commit.id}に出力する。\\
	\CMND{-8pt}{python ../bin/VersionControlSystem.py -G HEAD}{-8pt}
	\medskip

  \item 前項で作成したコミットIDファイル \FILE{Springhead.commit.id} 及び
	テスト結果ファイル \FILE{result.log} とを
	レポジトリ\TT{DailyBuildResult/Result}にコピーしてcommit and pushする。
	\medskip

  \item	結果履歴ファイル \FILE{result.log} を作成する。\\
	\CMND{-8pt}{python ../bin/VersionControlSystem.py -H -f result.log all}{-8pt}
	\medskip

  \item	テスト日付ファイル \FILE{test.date} を作成する。ファイルの内容は、\\
	\hspace{30pt}\tt{\framebox{
	    \begin{tabular}{l}
		** DO NOT EDIT THIS FILE **\\
		generated by "TestMainGit"\\
		- - - \it{YYYY-mmdd HH:MM:SS}
	    \end{tabular}}}\\
	\medskip
	である。このファイルは、Webページ``ビルドの状況テーブル''の日付表示に
	使用される。
	\medskip

  \item	ログファイルをWebサーバにコピーする。\\
	\begin{tabular}{ll}
	    コピー元 & \FILE{test/log/*}\\
	    コピー先 & \FILE{//haselab/HomeDirs/WWW/docroots/springhead/dailybuild/log}
	\end{tabular}
	\medskip

  \item	ディレクトリ\TT{core/include}に移動してSpringheadリファレンスマニュアルを
	作成する。\\
	\CMND{-8pt}{python SpringheadDoc.py}{-8pt}
	\medskip

  \item	ディレクトリ\TT{core/src}に移動してSpringhead SDK開発者マニュアルを
	作成する。\\
	\CMND{-8pt}{python SpringheadImpDoc.py}{-8pt}
	\medskip

  \item	ディレクトリ\TT{core/doc/SprManual}に移動してSpringhead Users Manualを
	作成する。\\
	\CMND{-8pt}{python MakeDoc.py}{-8pt}

\end{enumerate}

% end: 5.4.3.TestMainGit.tex
