% 5.4.15.TestResult.tex
%	Last update: 2018/06/12 F.Kanehori
%\newpage
\subsubsection{クラス VersionControlSystem}
\label{subsubsec:VersionControlSystem}

\begin{ClassDesc}
バージョン管理システムから種々の情報を取り出すためのラッパクラス。
取り扱えるのはSubversionとGitHubである。

\vspace{-.5\baselineskip}
\footnotesize{\begin{Table}[r][1em]{ll}
    \Item{\rm{(注)}}{%
	ただしGitHub版の実装以後Subversionについては
	メンテナンスを行なっていないので、正しく動作しない可能性がある。}
\end{Table}}
\vspace{-\baselineskip}
\end{ClassDesc}

\begin{Initializer}{obj = VersionControlSystem(system, url, wrkdir, verbose)}
\begin{Params}
    \Param{system}{%
	バージョン管理システムの識別(\tt{Subversion, GitHub, haselab})。
    }
    \Param{url}{バージョン管理システムのURL}
    \Param{wrkdir}{%
	指定したバージョン管理システムの管理下にあるディレクトリ。
	\tt{GitHub}の場合に必要となる。}
\end{Params}

\vspace{-\baselineskip}
\footnotesize{\begin{Table}[r][1em]{ll}
    \Item{\rm{(注)}}{%
	引数\tt{system}のうち\tt{haselab}は、
	このクラスのテストプログラムを外部プログラム(\tt{VersionInfo})として
	流用しているために必要な名称である。
	内部処理は\tt{GitHub}と同一であり、将来\tt{VersionInfo}を
	独立プログラムとして作成したならば削除すべきである。}
\end{Table}}
\vspace{-\baselineskip}
\end{Initializer}

\begin{Methods}{公開メソッド}
\Method{revison()}{%
    \begin{General}
	現在のレビジョン番号(GitHubのときはcommit-ID)を取得する。
	(\tt{code, rev, err})の3つ組を返す。
	\tt{code}が0のときは\tt{rev}にレビジョン番号
	(GitHubのときはcommit-IDのshort形式)が設定される。
	さもなければ\tt{err}にエラー情報が設定される。\\
	内部クラス\tt{Subversion, GitHub}に対するラッパメソッド。
    \end{General}
}
\Method{revison_info(revision)}{%
    \begin{General}
	引数で指定されたレビジョン(\tt{HEAD, all}も可)の情報を取得する。
	内部クラス\tt{Subversion, GitHub}に対するラッパメソッド。
	ただし\tt{Subversion}については実装されていない。\\
	(\tt{short_id, long_id, date})の3つ組を返す。
    \end{General}
}
\Method{get_file_content(path, revision)}{%
    \begin{General}
	引数で指定されたレビジョンのファイルのコピーを取得する。
	内部クラス\tt{Subversion, GitHub}に対するラッパメソッド。
	ただし\tt{Subversion}については実装されていない。\\
	\tt{path}は当該レポジトリのトップディレクトリからの相対パスで与える。
	\tt{revision}にはcommit-ID (short形式でもlong形式でも可)を与える。
	ファイルの内容(文字列)を返す。
    \end{General}
}
\end{Methods}

\begin{Methods}{内部クラス Subversion}
\Method{revision()}{%
    \begin{General}
	指定されたURLに次のコマンドを送って情報を得る。
	\CMND{.2\baselineskip}{svn info}{-.8\baselineskip}\\
	このうち、\tt{"Lase Changed Rev: \it{nnnnnnn}"}を含む行が
	現在のレビジョンに関する行である。
    \end{General}
}
\end{Methods}

\begin{Methods}{内部クラス GitHub}
\Method{revision()}{%
    \begin{General}
	指定されたURLに次のコマンドを送って情報を得る。
	\CMND{.2\baselineskip}
		{git log --abbrev-commit --oneline --max-count=1}
		{-.5\baselineskip}\\
	このうち、最初のフィールドがcommit-ID (short形式)である。
    \end{General}
}
\Method{revision_info(commit_id)}{%
    \begin{General}
	指定されたURLに次のコマンドを送って情報を得る。
	\CMND{.2\baselineskip}
		{git log --abbrev-commit --oneline --max-count=1}
		{-.5\baselineskip}\\
	このうち、\tt{"commit \it{nnnn}\CDOTS\it{nnnn}"}を含む行が
	commit-ID (long形式)を含む行、\tt{"Date: "}を含む行が日付を含む行である。
    \end{General}
}
\Method{get_file_content(path, commit_id)}{%
    \begin{General}
	指定されたURLに次のコマンドを送って情報を得る。
	\CMND{.2\baselineskip}{git show \it{commit_id, path}}{-.5\baselineskip}\\
	このコマンドの出力がファイルの内容である。
    \end{General}
}
\end{Methods}

% end: 5.4.15.TestResult.tex
