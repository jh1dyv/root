\makeatletter


%% \begin{GeneralBox}[typeface][indent]{title}
%	typeface	t(t), i(t), b(f), r(m), g(t), m(c)
%	indent		indent width (default: \WID)
%  \end{GeneralBox}
%
\def\GeneralBox{\@ifnextchar[{\GeneralBox@check}{\GeneralBox@@[b][\WID]}}
\def\GeneralBox@check[#1]%
	{\@ifnextchar[{\GeneralBox@@[#1]}{\GeneralBox@@[#1][\WID]}}
\def\GeneralBox@@[#1][#2]#3{%
	\if#1t \let\GeneralBox@typeface\tt \else
	\if#1i \let\GeneralBox@typeface\it \else
	\if#1b \let\GeneralBox@typeface\bf \else
	\if#1r \let\GeneralBox@typeface\rm \else
	\if#1g \let\GeneralBox@typeface\gt \else
	\if#1m \let\GeneralBox@typeface\mc \else
	       \let\GeneralBox@typeface\relax \fi\fi\fi\fi\fi\fi
	\vskip -.3ex\relax\noindent
	\GeneralBox@typeface{#3}\begin{narrow}[#2]}
\def\endGeneralBox{\end{narrow}\relax}

%% \begin{GeneralBase}{title}
%  \end{GeneralBase}
%
\def\GeneralBase#1{\def\GeneralBase@title{#1}%
	\@ifnextchar[{\GeneralBase@check}{\begin{GeneralBox}{\GeneralBase@title}}}
\def\GeneralBase@check[#1]{\@ifnextchar[{\GeneralBase@@[#1]}
	{\begin{GeneralBox}[#1][\WID]{\GeneralBase@title}}}
\def\GeneralBase@@[#1][#2]{\begin{GeneralBox}[#1][#2]{\GeneralBase@title}}
\def\endGeneralBase{\end{GeneralBox}}

%% \begin{Cmnd}[t][w]  ... \end{Cmnd}	% 起動方法
%  \begin{Opts}[t][w]  ... \end{Opts}	% オプション
%  \begin{Args}[t][w]  ... \end{Args}	% 引数
%  \begin{Brief}[t][w] ... \end{Brief}	% 概要
%  \begin{Proc}[t][w]  ... \end{Proc}	% 処理の説明
%	[t]	typeface (t,i,b,r,g,m)
%	[w]	indent width (dimen)
%
\def\isDefault{\rm{(\small{\,\NOTE はデフォルトを示す})}}
\def\Cmnd{\begin{GeneralBase}{起動方法}}
\def\endCmnd{\end{GeneralBase}}
\def\Opts{\begin{GeneralBase}{オプション \isDefault}}
\def\endOpts{\end{GeneralBase}}
\def\Args{\begin{GeneralBase}{引数 \isDefault}}
\def\endArgs{\end{GeneralBase}}
\def\Brief{\begin{GeneralBase}{概要}}
\def\endBrief{\end{GeneralBase}}
\def\Proc{\begin{GeneralBase}{処理の説明}}
\def\endProc{\end{GeneralBase}}

%% table with rightmost foldable column
% \begin{Table}[pos][fix part width]{table spec}
%   \Item[typeface]{width}{lastcolumn}	(*) t(\tt), i(\it), r(\rm)
%	typeface	
%						(**) without last column
%   \MC is alias to \multicolumn
% \end{Table}
\def\TableX{\@ifnextchar[{\TableX@pos}{\TableX@@[r][6em]}}
\def\TableX@pos[#1]{\@ifnextchar[{\TableX@@[#1]}{\TableX@@[#1][6em]}}
\def\TableX@{\@ifnexechar[{\TableX@@}{\TableX@@[c][6em]}}
\def\TableX@@[#1][#2]#3{
	\def\Table@name@wid{#2}
	\def\Table@desc@wid{\linewidth}
	\addtolength{\Table@desc@wid}{-\Table@name@wid}
	\addtolength{\Table@desc@wid}{-25pt}
	\Vskip{-.7\baselineskip}
	\begin{longtable}[#1]{#3}}
\def\endTableX{\end{longtable}\Vskip{-1.5\baselineskip}\relax}

\def\Item{\@ifnextchar[{\Item@}{\Item@[n]}}
\def\Item@[#1]#2#3{%
	\if#1t \let\Item@type@face\tt	\else
	\if#1i \let\Item@type@face\it	\else
	\if#1b \let\Item@type@face\bf	\else
	\if#1r \let\Item@type@face\rm	\else
	\if#1g \let\Item@type@face\gt	\else
	\if#1m \let\Item@type@face\mc	\else
	       \let\Item@type@face\relax	\fi\fi\fi\fi\fi\fi
	\hbox to \Table@name@wid{\hbox{\Item@type@face{#2}\hfill}}
	&\begin{minipage}[t]{\Table@desc@wid}#3

	\vspace{.2\baselineskip}\end{minipage}\\}
\def\ItemT#1#2#3{\tt{#1}&\tt{#2}
	&\begin{minipage}[t]{\Table@desc@wid}#3

	\vspace{.2\baselineskip}\end{minipage}\\}
\let\MC\multicolumn

%% \Vskip{amount}
%
\def\Vskip#1{\ifvmode\vspace{#1}\else\leavehmode\vspace{#1}\vbox{}\fi}

\makeatother

%% test code

\newpage
\noindent 最初の行
\begin{Cmnd}[b]
	Command invocation method
\end{Cmnd}
\begin{Opts}
	\begin{TableX}[r][\WID]{ll}
		\Item[t]{opt1}{desc1}
		\Item[t]{opt1}{desc1}
	\end{TableX}
\end{Opts}
\begin{Args}
	\begin{TableX}[t][\WID]{ll}
		\Item[t]{arg1}{desc1}
		\Item[t]{arg2}{desc2}
	\end{TableX}
\end{Args}
\begin{Brief}[b]
	コマンドの説明
\end{Brief}
最後の行

%\noindent テーブルのテスト
%\begin{TableX}[r][\WID]{ll}
%	\Item{123}{abc}
%	\Item{456}{xyz}
%\end{TableX}
%\noindent テーブルのテスト

