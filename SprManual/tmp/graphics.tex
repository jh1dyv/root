\section{\KLUDGE 概要}

\index{Graphics}
Graphics\KLUDGE は3D\KLUDGE シーンの描画機能を提供するモジュールです．

\section{Graphics SDK}

\index{GRSdk}
Graphics\KLUDGE モジュールのすべてのオブジェクトはSDK\KLUDGE クラス\texttt{GRSdk}\KLUDGE によって管理されます．
\texttt{GRSdk}\KLUDGE クラスは，プログラムの実行を通してただ１つのオブジェクトが存在するシングルトンクラスです．
\texttt{GRSdk}\KLUDGE オブジェクトを作成するには以下のようにします．
\begin{verbatim}
    GRSdkIf* grSdk = GRSdkIf::CreateSdk();
\end{verbatim}
\KLUDGE 通常この操作はプログラムの初期化時に一度だけ実行します．
\KLUDGE また，Framework\KLUDGE モジュールを使用する場合はユーザが直接\texttt{GRSdk}\KLUDGE を作成する必要はありません．

\texttt{GRSdk}\KLUDGE には以下の機能があります．
\begin{itemize}
\item \KLUDGE レンダラの作成
\item \KLUDGE デバイスの作成
\item \KLUDGE シーンの管理
\end{itemize}

\index{GRRender}
\index{\KLUDGE レンダラ}
\KLUDGE レンダラとは処理系に依存しない抽象化された描画機能を提供するクラスです．
\KLUDGE レンダラのクラスは\texttt{GRRender}\KLUDGE です．

\index{GRDeviceGL}
\index{\KLUDGE デバイス}
\KLUDGE 一方，デバイスは処理系ごとの描画処理の実装を行うクラスです．
\KLUDGE 現在のSpringhead\KLUDGE ではOpenGL\KLUDGE による描画のみがサポートされています．
OpenGL\KLUDGE 用デバイスクラスは\texttt{GRDeviceGL}\KLUDGE です．

\KLUDGE レンダラをデバイスに関する\texttt{GRSdk}\KLUDGE の関数を以下に示します．

\begin{center}
\begin{tabular}{p{.2\hsize}p{.40\hsize}p{.3\hsize}}
\texttt{GRSdkIf}		&								&	\\ \midrule
\texttt{GRRenderIf*} 	& \texttt{CreateRender()}		& \KLUDGE レンダラを作成		\\
\texttt{GRDeviceGLIf*} 	& \texttt{CreateDeviceGL()}		& OpenGL\KLUDGE デバイスを作成	\\
\end{tabular}
\end{center}

\begin{center}
\begin{tabular}{p{.2\hsize}p{.40\hsize}p{.3\hsize}}
\texttt{GRRenderIf}		&									&	\\ \midrule
\texttt{void}			& \texttt{SetDevice(GRDeviceIf*)}	& \KLUDGE デバイスの設定	\\
\texttt{GRDeviceIf*} 	& \texttt{GetDevice()}				& \KLUDGE デバイスの取得	\\
\end{tabular}
\end{center}

\subsection*{\KLUDGE 初期化}

Graphics\KLUDGE モジュールを使用するには以下の初期化処理を必ず実行する必要があります．
\begin{verbatim}
   	GRRenderIf* render = grSdk->CreateRender();
    GRDeviceIf* device = grSdk->CreateDeviceGL();
    device->Init();
    render->SetDevice(device);
\end{verbatim}
\texttt{GRRender}\KLUDGE の\texttt{SetDevice}\KLUDGE 関数でデバイスを登録すると，レンダラは実際の描画処理をそのデバイスを用いて行います．
\KLUDGE 将来的に処理系ごとにデバイスを使い分けることを想定し，上の処理はユーザが行うことになっています．
Framework\KLUDGE モジュールを使用する場合はユーザ自身で上の手続きを行う必要はありません．

\section{\KLUDGE シーン}
\label{sec_grscene}

\subsection*{\KLUDGE シーンの作成}

\index{GRScene}
Graphics\KLUDGE モジュールのシーンは，コンピュータグラフィクスにおけるいわゆるシーングラフと同等のものです．
\KLUDGE シーンクラスは\texttt{GRScene}\KLUDGE です．
\KLUDGE シーンを作成するには次のようにします．
\begin{verbatim}
    GRSceneIf* grScene = grSdk->CreateScene();
\end{verbatim}
\texttt{GRScene}\KLUDGE はディスクリプタによる設定項目を持ちません．
\KLUDGE また，Fig.\,\ref{fig_grscene}\KLUDGE に示すように\texttt{GRSdk}\KLUDGE オブジェクトは任意の数のシーンを保持できます．

\KLUDGE シーン作成に関する\texttt{GRSdk}\KLUDGE の関数は以下の通りです．

\begin{center}
\begin{tabular}{p{.15\hsize}p{.50\hsize}p{.25\hsize}}
\texttt{GRSdkIf}	&												&	\\ \midrule
\texttt{GRSceneIf*}	& \texttt{CreateScene()}						& \KLUDGE シーンを作成			\\
\texttt{GRSceneIf*}	& \texttt{GetScene(size\_t)}					& \KLUDGE シーンを取得			\\
\texttt{size\_t}	& \texttt{NScene()}								& \KLUDGE シーンの数			\\
\texttt{void}		& \texttt{MergeScene(GRSceneIf*, GRSceneIf*)}	& \KLUDGE シーンの統合			\\
\end{tabular}
\end{center}

\begin{figure}[t]
\begin{center}
\includegraphics[width=.4\hsize]{fig/grscene.eps}
\end{center}
\caption{Graphics data structure}
\label{fig_grscene}
\end{figure}

\subsection*{\KLUDGE シーンの機能}

\KLUDGE シーンを作成したら，次はそのコンテンツであるフレームやメッシュ，カメラやライトなどを作成してシーンに加えていきます．
\KLUDGE この方法としては完全に手動でシーンを構築する他にもFileIO\KLUDGE モジュールを使用してファイルからシーンをロードする方法もあります．
\KLUDGE 以下に\texttt{GRScene}\KLUDGE の関数を示します．

\begin{center}
\begin{tabular}{p{.15\hsize}p{.45\hsize}p{.3\hsize}}
\texttt{GRSceneIf}	 &															&	\\ \midrule
\texttt{GRFrameIf*}	 & \texttt{GetWorld()}										& \KLUDGE ワールドフレームの取得	\\
\texttt{GRCameraIf*} & \texttt{GetCamera()}										& \KLUDGE カメラの取得	\\
\texttt{void}		 & \texttt{SetCamera(const GRCameraDesc\&)}					& \KLUDGE カメラの設定	\\
\texttt{GRVisualIf*} & \texttt{CreateVisual(const GRVisualDesc\&, GRFrameIf*)}	& \KLUDGE 描画アイテムの作成	\\
\texttt{void}		 & \texttt{Render(GRRenderIf*)}								& \KLUDGE 描画	\\
\end{tabular}
\end{center}

%	///	\KLUDGE アニメーションコントローラの取得
%	GRAnimationControllerIf* GetAnimationController();

Fig.\,\ref{fig_grscene}\KLUDGE に示すように，1\KLUDGE つのシーンはただ1\KLUDGE つのワールドフレームを持ち，それを基点として
\KLUDGE 任意の数の描画アイテムがツリー状に連なります．
\KLUDGE ワールドフレームは\texttt{GetWorld}\KLUDGE で取得します．

\KLUDGE 特殊な描画アイテムにカメラがあります．
\KLUDGE カメラはワールドフレーム以下のツリーとは別に，\texttt{GRScene}\KLUDGE が保持します(Fig.\,\ref{fig_grscene})\KLUDGE ．
\KLUDGE カメラの設定は\texttt{SetCamera}\KLUDGE で行います．
\KLUDGE カメラを取得するには\texttt{GetCamera}\KLUDGE を使います．
\KLUDGE また，カメラはシーングラフ中の1\KLUDGE つのフレームを参照し，これを視点の設定に用います．
\KLUDGE イメージとしてはカメラが参照先のフレームに取り付けられていると考える方が自然でしょう．
\KLUDGE 参照先のフレームの移動に応じてカメラもシーン中を移動することになります．


\subsection*{\KLUDGE シーンの描画}

\KLUDGE 描画処理はプログラムの描画ハンドラで行います．GLUT\KLUDGE を使う場合は\texttt{glutDisplayFunc}\KLUDGE で登録したコールバック関数がこれにあたり，
\KLUDGE またFramework\KLUDGE モジュールの\texttt{FWApp}\KLUDGE を使う場合は\texttt{Display}\KLUDGE 仮想関数がこれにあたります．
\KLUDGE 以下が典型的な描画処理です．
\begin{verbatim}
    render->ClearBuffer();        // clear back buffer
    render->BeginScene();         // begin rendering

    grScene->Render(render);      // render scene

    render->EndScene();           // end rendering
    render->SwapBuffers();        // swap buffers
\end{verbatim}

\texttt{ClearBuffer}\KLUDGE は描画バッファを所定の色で塗りつぶします．
\KLUDGE 塗りつぶし色の取得/\KLUDGE 設定は\texttt{GRRender}\KLUDGE の\texttt{GetClearColor}\KLUDGE ，\text{SetClearColor}\KLUDGE を使います．
\begin{verbatim}
    render->SetClearColor(Vec4f(1.0f, 0.0f, 0.0f, 1.0f));
    render->ClearBuffer();        // clear back buffer in red
\end{verbatim}

\texttt{BeginScene}\KLUDGE と\texttt{EndScene}\KLUDGE はシーンの描画の前後で必ず呼び出します．
\texttt{SwapBuffers}\KLUDGE はフロントバッファとバックバッファを切り換えることで描画内容を画面上に表示します．

\texttt{GRScene}\KLUDGE の\texttt{Render}\KLUDGE 関数は，カメラ(\texttt{GRCamera})\KLUDGE の\texttt{Render}\KLUDGE とワールドフレーム(\texttt{GRFrame})\KLUDGE の\texttt{Render}\KLUDGE を
\KLUDGE 順次呼び出します．まずカメラの描画によって視点と投影変換が設定され，
\KLUDGE 次にワールドフレームの描画によってシーングラフが再帰的に描画されます．

\section{\KLUDGE 描画アイテム}

\begin{figure}[t]
\begin{center}
\includegraphics[width=.4\hsize]{fig/grvisual.eps}
\end{center}
\caption{Class hierarchy of visual items}
\label{fig_grvisual}
\end{figure}

\index{GRVisual}
\KLUDGE シーングラフを構成する描画アイテムの基本クラスは\texttt{GRVisual}\KLUDGE です．
\texttt{GRVisual}\KLUDGE から派生するクラスをFig.\,\ref{fig_grvisual}\KLUDGE に示します．
\KLUDGE 描画アイテムには以下の共通の機能があります．

\begin{center}
\begin{tabular}{p{.15\hsize}p{.45\hsize}p{.3\hsize}}
\multicolumn{3}{l}{\texttt{GRVisualIf}}					\\ \midrule
\texttt{void}	& \texttt{Render(GRRenderIf*)}		& 	\\
\texttt{void} 	& \texttt{Rendered(GRRenderIf*)}	& 	\\
\texttt{void} 	& \texttt{Enable(bool)}				& 	\\
\texttt{bool} 	& \texttt{IsEnabled()}				& 	\\
\end{tabular}
\end{center}

\texttt{Render}\KLUDGE はアイテムの描画を行い，\texttt{Rendered}\KLUDGE は描画の後処理を行います．
\KLUDGE 描画処理は描画アイテムの種類ごとに異なります．
\KLUDGE これについては次節以降で説明します．

\texttt{Enable}\KLUDGE 関数は描画処理の有効化/\KLUDGE 無効化を行います．
\KLUDGE 無効化されたアイテムは描画されません．
\texttt{IsEnabled}\KLUDGE 関数は有効/\KLUDGE 無効状態を返します．

\KLUDGE 描画アイテムを作成するには\texttt{GRScene}\KLUDGE の\texttt{CreateVisual}\KLUDGE 関数に種類ごとのディスクリプタを指定して呼び出します．


\section{\KLUDGE フレーム}

\index{GRFrame}
\index{\KLUDGE ふれーむ@\KLUDGE フレーム}
\KLUDGE フレームは座標変換を定義すると同時に他の描画アイテムのコンテナとしての役割を持ちます．
\KLUDGE フレームのクラスは\texttt{GRFrame}\KLUDGE です．
\KLUDGE 次のコードは，フレームを作成してワールドフレームの子として登録します．
\begin{verbatim}
    GRFrameDesc desc;
    GRFrameIf* frame =
        grScene->CreateVisual(desc, grScene->GetWorldFrame())->Cast();
\end{verbatim}
\texttt{CreateVisual}\KLUDGE 関数は指定されたディスクリプタに対応する描画アイテムを作成し，
\KLUDGE 指定された親フレームの子として登録します．親フレームを省くとデフォルトでワールドフレームに登録されます．
\KLUDGE したがって上のコードは\texttt{CreateVisual(desc)}\KLUDGE としてもかまいません．

\texttt{GRFrame}\KLUDGE の\texttt{Render}\KLUDGE 関数は，子描画アイテムの\texttt{Render}\KLUDGE を順次呼び出します．


\subsection*{\KLUDGE 親子関係}

\KLUDGE フレーム間の親子関係を管理する関数には次のものがあります．

\begin{center}
\begin{tabular}{p{.20\hsize}p{.45\hsize}p{.25\hsize}}
\multicolumn{3}{l}{\texttt{GRFrameIf}}						\\ \midrule
\texttt{GRFrameIf*}		& \texttt{GetParent()}				& 	\\
\texttt{void} 			& \texttt{SetParent(GRFrameIf*)}	& 	\\
\texttt{int} 			& \texttt{NChildren()}				& 	\\
\texttt{GRVisualIf**} 	& \texttt{GetChildren()}			& 	\\
\end{tabular}
\end{center}

\texttt{GetParent}\KLUDGE は親フレームを取得します．
\texttt{SetParent}\KLUDGE はそのフレームの親フレームを変更するために使います．
\texttt{NChildren}\KLUDGE はそのフレームの子である描画アイテムの数を返します．
\KLUDGE これらにはフレーム以外の描画アイテムも含まれることに注意してください．
\texttt{GetChildren}\KLUDGE は子描画アイテムの配列を取得します．


\subsection*{\KLUDGE 座標変換}

\KLUDGE フレームの座標変換を操作する関数は以下の通りです．

\begin{center}
\begin{tabular}{p{.15\hsize}p{.45\hsize}p{.3\hsize}}
\multicolumn{3}{l}{\texttt{GRFrameIf}}							\\ \midrule
\texttt{Affinef} & \texttt{GetTransform()}					& 	\\
\texttt{Affinef} & \texttt{GetWorldTransform()}				& 	\\
\texttt{void}	 & \texttt{SetTransform(const Affinef\&)}	& 	\\
\end{tabular}
\end{center}

\texttt{GetTransform}\KLUDGE ，\texttt{SetTransform}\KLUDGE はそれぞれフレームとその親フレームとの間の相対的な座標変換を取得/\KLUDGE 設定します．
\KLUDGE 例えば
\begin{verbatim}
    frame->SetTransform(Affinef::Trn(1.0, 0.0, 0.0));
\end{verbatim}
\KLUDGE とすると親フレームに対して相対的にx\KLUDGE 方向に$1.0$\KLUDGE 移動します．

\section{\KLUDGE カメラ}

\begin{figure}[t]
\begin{tabular}{c}
\includegraphics[width=.4\hsize]{fig/grcamera.eps} \\
(a) Perspective frustum \\
\\
\begin{tabular}{cc}
\includegraphics[width=.4\hsize]{fig/grcamera_front.eps} &
\includegraphics[width=.4\hsize]{fig/grcamera_top.eps} \\
(b) Front view of screen &
(c) Top view of screen
\end{tabular}
\end{tabular}
\caption{Camera parameters}
\label{fig_grcamera}
\end{figure}

\index{GRCamera}
\index{\KLUDGE かめら@\KLUDGE カメラ}
\KLUDGE カメラは描画における視点の設定と投影変換を管理します．
\KLUDGE はじめにカメラのディスクリプタを見ていきます．

\begin{center}
\begin{tabular}{p{.15\hsize}p{.45\hsize}p{.3\hsize}}
\multicolumn{3}{l}{\texttt{GRCameraDesc}}					\\ \midrule
\texttt{Vec2f}	&	\texttt{size}	& \KLUDGE スクリーンサイズ 		\\
\texttt{Vec2f}	&	\texttt{center}	& \KLUDGE スクリーン中心座標 	\\
\texttt{float}	&	\texttt{front}	& \KLUDGE 前方クリップ面		\\
\texttt{float}	&	\texttt{back}	& \KLUDGE 後方クリップ面		\\
\end{tabular}
\end{center}

\KLUDGE 各変数の定義はFig.\,\ref{fig_grcamera}(b),(c)\KLUDGE を参照してください．
\KLUDGE 設定を変更するには以下のようにします．
\begin{verbatim}
    GRCameraDesc desc;
    grScene->GetCamera()->GetDesc(&desc);
    desc.front = 3.0f;
    grScene->SetCamera(desc);
\end{verbatim}
\KLUDGE 上では\texttt{GetDesc}\KLUDGE 関数で既存の設定をディスクリプタにコピーし，\texttt{front}\KLUDGE を変更してから
\texttt{SetCamera}\KLUDGE 関数で再設定しています．

\KLUDGE 一方，\texttt{GRCamera}\KLUDGE の関数は以下の通りです．

\begin{center}
\begin{tabular}{p{.15\hsize}p{.45\hsize}p{.3\hsize}}
\multicolumn{3}{l}{\texttt{GRCameraIf}}					\\ \midrule
\texttt{GRFrameIf*}	& \texttt{GetFrame()}				&	\\
\texttt{void}		& \texttt{SetFrame(GRFrameIf*)}		&	\\
\end{tabular}
\end{center}

\texttt{GetFrame}\KLUDGE ，\texttt{SetFrame}\KLUDGE 関数はカメラフレームを取得/\KLUDGE 設定します．
Fig.\,\ref{fig_grcamera}(a)\KLUDGE のように，カメラフレームはカメラの視点を定義します．

\section{\KLUDGE ライト}

\index{GRLight}
\index{\KLUDGE らいと@\KLUDGE ライト}
\KLUDGE ライトはシーンの照明を設定するための描画アイテムです．
\KLUDGE ライトのクラス\texttt{GRLight}\KLUDGE のディスクリプタの代表的な変数を以下に示します．

\begin{center}
\begin{tabular}{p{.15\hsize}p{.45\hsize}p{.3\hsize}}
\multicolumn{3}{l}{\texttt{GRLightDesc}}				\\ \midrule
\texttt{Vec4f}	&	\texttt{ambient}	& \KLUDGE 環境光 		\\
\texttt{Vec4f}	&	\texttt{diffuse}	& \KLUDGE 拡散光 		\\
\texttt{Vec4f}	&	\texttt{specular}	& \KLUDGE 鏡面光		\\
\texttt{Vec4f}	&	\texttt{position}	& \KLUDGE ライト位置	\\
\end{tabular}
\end{center}

\KLUDGE 減衰係数やスポットライトなどのより詳細な設定項目についてはソースファイルを参照してください．
OpenGL\KLUDGE の仕様と同様，\texttt{position}\KLUDGE の第4\KLUDGE 成分\texttt{position.w}\KLUDGE が$0$\KLUDGE の場合は平行光源となり，
\texttt{(x,y,z)}\KLUDGE 方向の無限遠にライトがあることになり，\texttt{position.w}\KLUDGE が$1$\KLUDGE の場合は
\texttt{(x,y,z)}\KLUDGE の位置に点光源がおかれます．

\section{\KLUDGE マテリアル}
\label{sec_grmaterial}

\index{GRMaterial}
\index{\KLUDGE まてりある@\KLUDGE マテリアル}
\KLUDGE マテリアルは材質を指定するためのアイテムです．
\KLUDGE マテリアルのクラスは\texttt{GRMaterial}\KLUDGE です．
\KLUDGE 通常，マテリアルは次節で説明するメッシュの子描画アイテムとなります．
\KLUDGE ファイルからメッシュをロードする場合は，メッシュの作成と同時にマテリアルも自動的に作成され，メッシュの子として追加されます．
\texttt{GRMaterial}\KLUDGE のディスクリプタは以下の通りです．

\begin{center}
\begin{tabular}{p{.15\hsize}p{.45\hsize}p{.3\hsize}}
\multicolumn{3}{l}{\texttt{GRMaterialDesc}}				\\ \midrule
\texttt{Vec4f}		&	\texttt{ambient}	& \KLUDGE 環境色 	\\
\texttt{Vec4f}		&	\texttt{diffuse}	& \KLUDGE 拡散色 	\\
\texttt{Vec4f}		&	\texttt{specular}	& \KLUDGE 鏡面色	\\
\texttt{Vec4f}		&	\texttt{emissive}	& \KLUDGE 自己発光	\\
\texttt{float}		&	\texttt{power}		& \KLUDGE 鏡面係数	\\
\texttt{UTString}	&	\texttt{texname}	& \KLUDGE テクスチャファイル名
\end{tabular}
\end{center}

\KLUDGE レンダラにマテリアルを設定すると，次に別のマテリアルを設定するまでの間の
\KLUDGE 形状描画にそのマテリアルの描画属性が適用されます．
\KLUDGE マテリアルを設定するにはいくつかの方法があります．
\KLUDGE 一つ目は\texttt{GRMaterialIf}\KLUDGE の\texttt{Render}\KLUDGE 関数を呼ぶ方法です:
\KLUDGE これに加え，以下に示す\texttt{GRRender}\KLUDGE の関数のいずれかを用いることもできます．
\begin{center}
\begin{tabular}{p{.1\hsize}p{.5\hsize}p{.3\hsize}}
\texttt{GRRenderIf}																\\ \midrule
\texttt{void} & \texttt{SetMaterial(const GRMaterialDesc\&)}		& \KLUDGE 描画マテリアルの設定	\\
\texttt{void} & \texttt{SetMaterial(const GRMaterialIf*)}			& \KLUDGE 描画マテリアルの設定	\\
\texttt{void} & \texttt{SetMaterial(int)}							& \KLUDGE 描画マテリアルの設定	\\
\end{tabular}
\end{center}
\KLUDGE 以下の例はマテリアルを設定する3\KLUDGE 通りの方法を示しています．
\KLUDGE どの方法を用いても結果は変わりません．
\begin{verbatim}
    // given GRRenderIf* render, GRSceneIf* scene
    GRMaterialDesc md;
    md.diffuse = Vec4f(1.0f, 0.0f, 0.0f, 1.0f);
    // 1.
    render->SetMaterial(md);
    // 2.
    GRMaterialIf* mat = scene->CreateVisual(md)->Cast();
    mat->Render(render);
    // 3.
    render->SetMaterial(mat);
\end{verbatim}
\KLUDGE 毎回マテリアルを作成するのは煩わしいことがあります．
\KLUDGE そのような場合はレンダラの予約色を指定することも可能です．
\begin{verbatim}
    // 4.
    render->SetMaterial(GRRenderBaseIf::RED);
\end{verbatim}
\KLUDGE 使用可能な予約色はX11 web color\KLUDGE にもとづいています．
\KLUDGE 詳しくは\texttt{SprGRRender.h}\KLUDGE ヘッダファイルを

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{comment}

\begin{table}[t]
\caption{Reserved colors}
\label{table_material_sample}
{\small
\begin{center}
\begin{tabular}{ll|ll}
RED				& {\color[RGB]{255,0,0}$\blacksquare$} 			(1.00, 0.00, 0.00)	&
GREEN			& {\color[rgb]{0,1,0}$\blacksquare$} 			(0.00, 1.00, 0.00)	\\
BLUE			& {\color[rgb]{0,0,1}$\blacksquare$} 			(0.00, 0.00, 1.00)	&
YELLOW			& {\color[rgb]{1,1,0}$\blacksquare$} 			(1.00, 1.00, 0.00)	\\
CYAN			& {\color[rgb]{0,1,1}$\blacksquare$} 			(0.00, 1.00, 1.00)	&
MAGENTA			& {\color[rgb]{1,0,1}$\blacksquare$} 			(1.00, 0.00, 1.00)	\\
WHITE			& {$\square$} 						 			(1.00, 1.00, 1.00)	&
GRAY			& {\color[rgb]{.5,.5,.5}$\blacksquare$} 		(0.50, 0.50, 0.50)	\\
ORANGE			& {\color[rgb]{1,.27,0}$\blacksquare$} 			(1.00, 0.27, 0.00)	&
BROWN			& {\color[rgb]{.198,0,0}$\blacksquare$} 		(0.19, 0.00, 0.00)	\\
LIGHT\_BLUE		& {\color[rgb]{.676,.844,.898}$\blacksquare$} 	(0.67, 0.84, 0.89)	&
MEDIUM\_PURPLE	& {\color[rgb]{.574,.438,.855}$\blacksquare$} 	(0.57, 0.43, 0.85)	\\
DARK\_GREEN		& {\color[rgb]{0,.391,0}$\blacksquare$} 		(0.00, 0.39, 0.00)	&
DARK\_VIOLET	& {\color[rgb]{.578,0,.824}$\blacksquare$} 		(0.57, 0.00, 0.82)	\\
DARK\_CYAN		& {\color[rgb]{0,.543,.543}$\blacksquare$} 		(0.00, 0.54, 0.54)	&
GREEN\_YELLOW	& {\color[rgb]{.676,1,.184}$\blacksquare$} 		(0.67, 1.00, 0.18)	\\
LIME\_GREEN		& {\color[rgb]{.195,.801,.195}$\blacksquare$} 	(0.19, 0.80, 0.19)	&
INDIAN\_RED		& {\color[rgb]{.801,.359,.359}$\blacksquare$} 	(0.80, 0.35, 0.35)	\\
INDIGO			& {\color[rgb]{.293,0,.508}$\blacksquare$} 		(0.29, 0.00, 0.50)	&
GREEN\_INDIGO	& {\color[rgb]{0,.198,.198}$\blacksquare$} 		(0.00, 0.19, 0.19)	\\
OLIVE\_GREEN	& {\color[rgb]{.198,.398,0}$\blacksquare$} 		(0.19, 0.39, 0.00)	&
NAVY\_BLUE		& {\color[rgb]{.198,.398,.797}$\blacksquare$} 	(0.19, 0.39, 0.79)	\\
TURQUOISE\_BLUE	& {\color[rgb]{.398,1,.797}$\blacksquare$} 		(0.39, 1.00, 0.79)	&
EMERALD\_GREEN	& {\color[rgb]{.598,1,.398}$\blacksquare$} 		(0.59, 1.00, 0.39)
\end{tabular}
\end{center}
}
\end{table}

\end{comment}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{table}[t]
\caption{Reserved colors}
\label{table_material_sample}
{\tiny
\begin{center}
\ifLwarp\else
\begin{tabular}{l|l}
\fi
\begin{tabular}{lll}
INDIANRED		& {\color[RGB]{205,92,92}$\blacksquare$}	& (205 92 92) \\
LIGHTCORAL		& {\color[RGB]{240,128,128}$\blacksquare$}	& (240 128 128) \\
SALMON			& {\color[RGB]{250,128,114}$\blacksquare$}	& (250 128 114) \\
DARKSALMON		& {\color[RGB]{233,150,122}$\blacksquare$}	& (233 150 122) \\
LIGHTSALMON		& {\color[RGB]{255,160,122}$\blacksquare$}	& (255 160 122) \\
RED				& {\color[RGB]{255,0,0}$\blacksquare$}		& (255 0 0) \\
CRIMSON			& {\color[RGB]{220,20,60}$\blacksquare$}	& (220 20 60) \\
FIREBRICK		& {\color[RGB]{178,34,34}$\blacksquare$}	& (178 34 34) \\
DARKRED			& {\color[RGB]{139,0,0}$\blacksquare$}		& (139 0 0) \\
\\
PINK			& {\color[RGB]{255,192,203}$\blacksquare$}	& (255 192 203)	\\
LIGHTPINK		& {\color[RGB]{255,182,193}$\blacksquare$}	& (255 182 193)	\\
HOTPINK			& {\color[RGB]{255,105,180}$\blacksquare$}	& (255 105 180)	\\
DEEPPINK		& {\color[RGB]{255, 20,147}$\blacksquare$}	& (255  20 147)	\\
MEDIUMVIOLETRED	& {\color[RGB]{199, 21,133}$\blacksquare$}	& (255  21 133)	\\
PALEVIOLETRED	& {\color[RGB]{219,112,147}$\blacksquare$}	& (255 112 147)	\\
\\
CORAL			& {\color[RGB]{255,127, 80}$\blacksquare$}	& (255 127 80)	\\
TOMATO			& {\color[RGB]{255, 99, 71}$\blacksquare$}	& (255  99 71)	\\
ORANGERED		& {\color[RGB]{255, 69,  0}$\blacksquare$}	& (255  69 0)	\\
DARKORANGE		& {\color[RGB]{255,140,  0}$\blacksquare$}	& (255 140 0)	\\
ORANGE			& {\color[RGB]{255,165,  0}$\blacksquare$}	& (255 165 0)	\\
\\
GOLD					& {\color[RGB]{255,215,0}$\blacksquare$}	& (255 215 0)	\\
YELLOW					& {\color[RGB]{255,255,0}$\blacksquare$}	& (255 255 0)	\\
LIGHTYELLOW				& {\color[RGB]{255,255,224}$\blacksquare$}	& (255 255 224)	\\
LEMONCHIFFON			& {\color[RGB]{255,250,205}$\blacksquare$}	& (255 250 205)	\\
LIGHTGOLDENRODYELLOW	& {\color[RGB]{250,250,210}$\blacksquare$}	& (250 250 210)	\\
PAPAYAWHIP				& {\color[RGB]{255,239,213}$\blacksquare$}	& (255 239 213)	\\
MOCCASIN				& {\color[RGB]{255,228,181}$\blacksquare$}	& (255 228 181)	\\
PEACHPUFF				& {\color[RGB]{255,218,185}$\blacksquare$}	& (255 218 185)	\\
PALEGOLDENROD			& {\color[RGB]{238,232,170}$\blacksquare$}	& (238 232 170)	\\
KHAKI					& {\color[RGB]{240,230,140}$\blacksquare$}	& (240 230 140)	\\
DARKKHAKI				& {\color[RGB]{189,183,107}$\blacksquare$}	& (189 183 107)	\\
\\						
LAVENDAR				& {\color[RGB]{230,230,250}$\blacksquare$}	& (230 230 250)	\\
THISTLE					& {\color[RGB]{216,191,216}$\blacksquare$}	& (216 191 216)	\\
PLUM					& {\color[RGB]{221,160,221}$\blacksquare$}	& (221 160 221)	\\
VIOLET					& {\color[RGB]{238,130,238}$\blacksquare$}	& (238 130 238)	\\
ORCHILD					& {\color[RGB]{218,112,214}$\blacksquare$}	& (218 112 214)	\\
FUCHSIA					& {\color[RGB]{255,0,255}$\blacksquare$}	& (255 0 255)	\\
MAGENTA					& {\color[RGB]{255,0,255}$\blacksquare$}	& (255 0 255)	\\
MEDIUMORCHILD			& {\color[RGB]{186,85,211}$\blacksquare$}	& (186 85 211)	\\
MEDIUMPURPLE			& {\color[RGB]{147,112,219}$\blacksquare$}	& (147 112 219)	\\
BLUEVIOLET				& {\color[RGB]{138,43,226}$\blacksquare$}	& (138 43 226)	\\
DARKVIOLET				& {\color[RGB]{148,0,211}$\blacksquare$}	& (148 0 211)	\\
DARKORCHILD				& {\color[RGB]{153,50,204}$\blacksquare$}	& (153 50 204)	\\
DARKMAGENTA				& {\color[RGB]{139,0,139}$\blacksquare$}	& (139 0 139)	\\
PURPLE					& {\color[RGB]{128,0,128}$\blacksquare$}	& (128 0 128)	\\
INDIGO					& {\color[RGB]{75,0,130}$\blacksquare$}	& (75 0 130)	\\
DARKSLATEBLUE			& {\color[RGB]{72,61,139}$\blacksquare$}	& (72 61 139)	\\
SLATEBLUE				& {\color[RGB]{106,90,205}$\blacksquare$}	& (106 90 205)	\\
MEDIUMSLATEBLUE			& {\color[RGB]{123,104,238}$\blacksquare$}	& (123 104 238)	\\
\\
GREENYELLOW				& {\color[RGB]{173,255,47}$\blacksquare$}	& (173 255 47)	\\
CHARTREUSE				& {\color[RGB]{127,255,0}$\blacksquare$}	& (127 255 0)	\\
LAWNGREEN				& {\color[RGB]{124,252,0}$\blacksquare$}	& (124 252 0)	\\
LIME					& {\color[RGB]{0,255,0}$\blacksquare$}	& (0 255 0)	\\
LIMEGREEN				& {\color[RGB]{50,205,50}$\blacksquare$}	& (50 205 50)	\\
PALEGREEN				& {\color[RGB]{152,251,152}$\blacksquare$}	& (152 251 152)	\\
LIGHTGREEN				& {\color[RGB]{144,238,144}$\blacksquare$}	& (144 238 144)	\\
MEDIUMSPRINGGREEN		& {\color[RGB]{0,250,154}$\blacksquare$}	& (0 250 154)	\\
SPRINGGREEN				& {\color[RGB]{0,255,127}$\blacksquare$}	& (0 255 127)	\\
MEDIUMSEAGREEN			& {\color[RGB]{60,179,113}$\blacksquare$}	& (60 179 113)	\\
SEAGREEN				& {\color[RGB]{46,139,87}$\blacksquare$}	& (46 139 87)	\\
FORESTGREEN				& {\color[RGB]{34,139,34}$\blacksquare$}	& (34 139 34)	\\
GREEN					& {\color[RGB]{0,128,0}$\blacksquare$}	& (0 128 0)	\\
DARKGREEN				& {\color[RGB]{0,100,0}$\blacksquare$}	& (0 100 0)	\\
YELLOWGREEN				& {\color[RGB]{154,205,50}$\blacksquare$}	& (154 205 50)	\\
OLIVEDRAB				& {\color[RGB]{107,142,35}$\blacksquare$}	& (107 142 35)	\\
OLIVE					& {\color[RGB]{128,128,0}$\blacksquare$}	& (128 128 0)	\\
DARKOLIVEGREEN			& {\color[RGB]{85,107,47}$\blacksquare$}	& (85 107 47)	\\
MEDIUMAQUAMARINE		& {\color[RGB]{102,205,170}$\blacksquare$}	& (102 205 170)	\\
DARKSEAGREEN			& {\color[RGB]{143,188,143}$\blacksquare$}	& (143 188 143)	\\
LIGHTSEAGREEN			& {\color[RGB]{32,178,170}$\blacksquare$}	& (32 178 170)	\\
DARKCYAN				& {\color[RGB]{0,139,139}$\blacksquare$}	& (0 139 139)	\\
TEAL					& {\color[RGB]{0,128,128}$\blacksquare$}	& (0 128 128)	\\
\\
\end{tabular}
\ifLwarp\vspace{2\baselineskip}\else
&
\fi
\begin{tabular}{lll}
AQUA				& {\color[RGB]{0,255,255}$\blacksquare$}	& (0 255 255)	\\
CYAN				& {\color[RGB]{0,255,255}$\blacksquare$}	& (0 255 255)	\\
LIGHTCYAN			& {\color[RGB]{224,255,255}$\blacksquare$}	& (224 255 255)	\\
PALETURQUOISE		& {\color[RGB]{175,238,238}$\blacksquare$}	& (175 238 238)	\\
AQUAMARINE			& {\color[RGB]{127,255,212}$\blacksquare$}	& (127 255 212)	\\
TURQUOISE			& {\color[RGB]{64,224,208}$\blacksquare$}	& (64 224 208)	\\
MEDIUMTURQUOISE		& {\color[RGB]{72,209,204}$\blacksquare$}	& (72 209 204)	\\
DARKTURQUOISE		& {\color[RGB]{0,206,209}$\blacksquare$}	& (0 206 209)	\\
CADETBLUE			& {\color[RGB]{95,158,160}$\blacksquare$}	& (95 158 160)	\\
STEELBLUE			& {\color[RGB]{70,130,180}$\blacksquare$}	& (70 130 180)	\\
LIGHTSTEELBLUE		& {\color[RGB]{176,196,222}$\blacksquare$}	& (176 196 222)	\\
POWDERBLUE			& {\color[RGB]{176,224,230}$\blacksquare$}	& (176 224 230)	\\
LIGHTBLUE			& {\color[RGB]{173,216,230}$\blacksquare$}	& (173 216 230)	\\
SKYBLUE				& {\color[RGB]{135,206,235}$\blacksquare$}	& (135 206 235)	\\
LIGHTSKYBLUE		& {\color[RGB]{135,206,250}$\blacksquare$}	& (135 206 250)	\\
DEEPSKYBLUE			& {\color[RGB]{0,191,255}$\blacksquare$}	& (0 191 255)	\\
DODGERBLUE			& {\color[RGB]{30,144,255}$\blacksquare$}	& (30 144 237)	\\
CORNFLOWERBLUE		& {\color[RGB]{100,149,237}$\blacksquare$}	& (65 105 225)	\\
ROYALBLUE			& {\color[RGB]{65,105,225}$\blacksquare$}	& (65 105 225)	\\
BLUE				& {\color[RGB]{0,0,255}$\blacksquare$}	& (0 0 255)	\\
MEDIUMBLUE			& {\color[RGB]{0,0,205}$\blacksquare$}	& (0 0 205)	\\
DARKBLUE			& {\color[RGB]{0,0,139}$\blacksquare$}	& (0 0 139)	\\
NAVY				& {\color[RGB]{0,0,128}$\blacksquare$}	& (0 0 128)	\\
MIDNIGHTBLUE		& {\color[RGB]{25,25,112}$\blacksquare$}	& (25 25 112)	\\
\\
CORNSILK			& {\color[RGB]{255,248,220}$\blacksquare$}	& (255 248 220)	\\
BLANCHEDALMOND		& {\color[RGB]{255,235,205}$\blacksquare$}	& (255 235 205)	\\
BISQUE				& {\color[RGB]{255,228,196}$\blacksquare$}	& (255 228 196)	\\
NAVAJOWHITE			& {\color[RGB]{255,222,173}$\blacksquare$}	& (255 222 173)	\\
WHEAT				& {\color[RGB]{245,222,179}$\blacksquare$}	& (245 222 179)	\\
BURLYWOOD			& {\color[RGB]{222,184,135}$\blacksquare$}	& (222 184 135)	\\
TAN					& {\color[RGB]{210,180,140}$\blacksquare$}	& (210 180 140)	\\
ROSYBROWN			& {\color[RGB]{188,143,143}$\blacksquare$}	& (188 143 143)	\\
SANDYBROWN			& {\color[RGB]{244,164,96}$\blacksquare$}	& (244 164 96)	\\
GOLDENROD			& {\color[RGB]{218,165,32}$\blacksquare$}	& (218 165 32)	\\
DARKGOLDENROD		& {\color[RGB]{184,134,11}$\blacksquare$}	& (184 134 11)	\\
PERU				& {\color[RGB]{205,133,63}$\blacksquare$}	& (205 133 63)	\\
CHOCOLATE			& {\color[RGB]{210,105,30}$\blacksquare$}	& (210 105 30)	\\
SADDLEBROWN			& {\color[RGB]{139,69,19}$\blacksquare$}	& (139 69 19)	\\
SIENNA				& {\color[RGB]{160,82,45}$\blacksquare$}	& (160 82 45)	\\
BROWN				& {\color[RGB]{154,42,42}$\blacksquare$}	& (154 42 42)	\\
MAROON				& {\color[RGB]{128,0,0}$\blacksquare$}	& (128 0 0)	\\
\\
WHITE				& {\color[RGB]{255,255,255}$\blacksquare$}	& (255 255 255)	\\
SNOW				& {\color[RGB]{255,250,250}$\blacksquare$}	& (255 250 250)	\\
HONEYDEW			& {\color[RGB]{240,255,240}$\blacksquare$}	& (240 255 240)	\\
MINTCREAM			& {\color[RGB]{245,255,250}$\blacksquare$}	& (245 255 250)	\\
AZURE				& {\color[RGB]{240,255,255}$\blacksquare$}	& (240 255 255)	\\
ALICEBLUE			& {\color[RGB]{240,248,255}$\blacksquare$}	& (240 248 255)	\\
GHOSTWHITE			& {\color[RGB]{248,248,255}$\blacksquare$}	& (248 248 255)	\\
WHITESMOKE			& {\color[RGB]{245,245,245}$\blacksquare$}	& (245 245 245)	\\
SEASHELL			& {\color[RGB]{255,245,238}$\blacksquare$}	& (255 245 238)	\\
BEIGE				& {\color[RGB]{245,245,220}$\blacksquare$}	& (245 245 220)	\\
OLDLACE				& {\color[RGB]{253,245,230}$\blacksquare$}	& (253 245 230)	\\
FLORALWHITE			& {\color[RGB]{255,250,240}$\blacksquare$}	& (255 250 240)	\\
IVORY				& {\color[RGB]{255,255,240}$\blacksquare$}	& (255 255 240)	\\
ANTIQUEWHITE		& {\color[RGB]{250,235,215}$\blacksquare$}	& (250 235 215)	\\
LINEN				& {\color[RGB]{250,240,230}$\blacksquare$}	& (250 240 230)	\\
LAVENDERBLUSH		& {\color[RGB]{255,240,245}$\blacksquare$}	& (255 240 245)	\\
MISTYROSE			& {\color[RGB]{255,228,225}$\blacksquare$}	& (255 228 225)	\\
\\
GAINSBORO			& {\color[RGB]{220,220,220}$\blacksquare$}	& (220 220 220)	\\
LIGHTGRAY			& {\color[RGB]{211,211,211}$\blacksquare$}	& (211 211 211)	\\
SILVER				& {\color[RGB]{192,192,192}$\blacksquare$}	& (192 192 192)	\\
DARKGRAY			& {\color[RGB]{169,169,169}$\blacksquare$}	& (169 169 169)	\\
GRAY				& {\color[RGB]{128,128,128}$\blacksquare$}	& (128 128 128)	\\
DIMGRAY				& {\color[RGB]{105,105,105}$\blacksquare$}	& (105 105 105)	\\
LIGHTSLATEGRAY		& {\color[RGB]{119,136,153}$\blacksquare$}	& (119 136 153)	\\
SLATEGRAY			& {\color[RGB]{112,128,144}$\blacksquare$}	& (112 128 144)	\\
DARKSLATEGRAY		& {\color[RGB]{47,79,79}$\blacksquare$}	& (47 79 79)	\\
BLACK				& {\color[RGB]{0,0,0}$\blacksquare$}	& (0 0 0)	\\
\\
\\
\\
\\
\\
\\
\\
\end{tabular}
\ifLwarp\else
\end{tabular}
\fi
\end{center}
}
\end{table}

\texttt{GRRenderBaseIf}\KLUDGE が持つ予約色（全24\KLUDGE 色，Table\,\ref{table_material_sample}\KLUDGE 参照）です．

\section{\KLUDGE メッシュ}

\index{GRMesh}
\index{\KLUDGE めっしゅ@\KLUDGE メッシュ}
\KLUDGE メッシュは多面体形状を表現するための描画アイテムです．
\KLUDGE メッシュのクラスは\texttt{GRMesh}\KLUDGE です．
\KLUDGE メッシュを作成する方法には
\begin{itemize}
\item \KLUDGE ディスクリプタを用いて手動で作成する
\item FileIO\KLUDGE モジュールを利用してファイルからメッシュをロードする
\end{itemize}
\KLUDGE の二通りがあります．
\KLUDGE 後者の方法では，モデリングソフトで作成し，Direct3D\KLUDGE のX\KLUDGE 形式などで出力したファイルから形状をロードすることができます．
\KLUDGE 詳しくは\ref{chap_fileio}\KLUDGE 章を参照してください．
\KLUDGE また，メッシュのみをロードする簡易機能として\texttt{FWObjectIf::LoadMesh}\KLUDGE が用意されています．

\KLUDGE 以下では前者の手動構築の方法について説明します．
\KLUDGE メッシュのディスクリプタは次の通りです．
\begin{center}
\begin{tabular}{p{.3\hsize}p{.3\hsize}p{.3\hsize}}
\multicolumn{3}{l}{\texttt{GRMeshDesc}}					\\ \midrule
\texttt{vector<Vec3f>}		&	\texttt{vertices}		& \KLUDGE 頂点	 			\\
\texttt{vector<GRMeshFace>}	&	\texttt{faces}			& \KLUDGE 面	 			\\
\texttt{vector<Vec3f>}		&	\texttt{normals}		& \KLUDGE 法線				\\
\texttt{vector<GRMeshFace>}	&	\texttt{faceNormals}	& \KLUDGE 面法線			\\
\texttt{vector<Vec4f>}		&	\texttt{colors}			& \KLUDGE 色				\\
\texttt{vector<Vec2f>}		&	\texttt{texCoords}		& \KLUDGE テクスチャ座標	\\
\texttt{vector<int>}		&	\texttt{materialList}	& \KLUDGE マテリアルリスト
\end{tabular}
\end{center}
\texttt{vector}\KLUDGE は\texttt{C++}\KLUDGE の可変長配列コンテナです．
\texttt{vertices}\KLUDGE は頂点座標を格納した配列です．
\KLUDGE ただし頂点座標を設定しただけでは形状は定義されません．
\KLUDGE メッシュは面の集合ですので，\texttt{faces}\KLUDGE を設定する必要があります．
\texttt{GRMeshFace}\KLUDGE の定義は以下の通りです．
\begin{center}
\begin{tabular}{p{.3\hsize}p{.3\hsize}p{.3\hsize}}
\multicolumn{3}{l}{\texttt{GRMeshFace}}					\\ \midrule
\texttt{int}	&	\texttt{nVertices}		& \KLUDGE 頂点数 	\\
\texttt{int}	&	\texttt{indices[4]}		& \KLUDGE 頂点インデックス
\end{tabular}
\end{center}
\texttt{nVertices}\KLUDGE は1\KLUDGE つの面を構成する頂点数で，3\KLUDGE か4\KLUDGE を設定します．
\texttt{indices}\KLUDGE には\texttt{nVertices}\KLUDGE 個の頂点インデックスを設定します．
\KLUDGE このとき
\begin{align*}
\texttt{vertices[faces[i].indices[j]]}
\end{align*}
\KLUDGE が$i$\KLUDGE 番目の面の$j$\KLUDGE 番目の頂点座標となります．

\texttt{GRMeshDesc}\KLUDGE のメンバ変数の中で\texttt{vertices}\KLUDGE と\texttt{faces}\KLUDGE は必須ですが，
\KLUDGE その他のメンバは必ずしも設定する必要はありません．
\texttt{normals}\KLUDGE は各頂点の法線の向きをを格納する配列です．
\texttt{normals[i]}\KLUDGE が\texttt{vertices[i]}\KLUDGE の法線を与えます．
\texttt{normals}\KLUDGE を省略した場合，法線は自動生成されます．
\KLUDGE このとき，各頂点の法線はその頂点を共有する面の法線の平均で与えられます．

\texttt{normals}\KLUDGE に加えて\texttt{faceNormals}\KLUDGE を設定した場合，異なる方法で法線が与えられます．
\KLUDGE このとき
\begin{align*}
\texttt{normals[faceNormals[i].indices[j]]}
\end{align*}
\KLUDGE が$i$\KLUDGE 番目の面の$j$\KLUDGE 番目の頂点に対応する法線となります．

\texttt{colors}\KLUDGE は頂点色です．\texttt{colors[i]}\KLUDGE が$i$\KLUDGE 番目の頂点の色を与えます．

\texttt{texCoords}\KLUDGE は頂点ごとのテクスチャUV\KLUDGE 座標を与えます．
\KLUDGE テクスチャを描画するには，メッシュに割り当てるマテリアルにテクスチャファイル名が設定されている必要があります．

\texttt{materialList}\KLUDGE は面ごとに異なるマテリアルを割り当てるために用います．
\texttt{materialList[i]}\KLUDGE が$i$\KLUDGE 番目の面のマテリアル番号を与えます．
\KLUDGE ただし，番号に対応するマテリアルは別途メッシュに割り当てておく必要があります．

\subsection*{\KLUDGE メッシュへのマテリアルの割当て}

\KLUDGE ファイルからメッシュをロードする場合，もしファイル中にマテリアル情報が含まれていれば
\KLUDGE それをもとに自動的にマテリアルがメッシュへ割り当てられます．

\KLUDGE 手動でメッシュに割り当てるには，\texttt{AddChildObject}\KLUDGE を使います．
\KLUDGE 以下に例を示します．
\begin{verbatim}
    // given GRSceneIf* scene, GRFrameIf* frame
    GRMeshDesc meshDesc;
    // ... setup discriptor here ...

    // create mesh and attach it to frame
    GRMeshIf* mesh = scene->CreateVisual(meshDesc, frame)->Cast();

    GRMaterialDesc matDesc0, matDesc1;
    // ... setup materials here ...
    GRMaterialIf* mat0 = scene->CreateVisual(matDesc0, frame)->Cast();
    GRMaterialIf* mat1 = scene->CreateVisual(matDesc1, frame)->Cast();

    // attach materials to mesh
    mesh->AddChildObject(mat0);    //< material no.0
    mesh->AddChildObject(mat1);    //< material no.1
\end{verbatim}
\KLUDGE 最初に割り当てられたマテリアルを0\KLUDGE 番として昇順でマテリアル番号が決まります．
\KLUDGE 前述のマテリアルリストを用いる場合はこのマテリアル番号を面毎に指定してください．


\section{\KLUDGE レンダラ}

\index{GRRender}
\index{\KLUDGE レンダラ}
\KLUDGE レンダラの機能を項目別に説明します．
\KLUDGE レンダラは提供するプリミティブな描画機能は非常に多岐に渡りますが，これらのほとんどの関数は特別な描画処理を必要としない限りユーザが直接呼び出すことはありません．
\KLUDGE 個々の関数を詳しく説明していくと膨大な量になりますので，ここでは一覧程度にとどめます．
\KLUDGE 詳細な仕様はソースコードのコメントを参照してください．

\subsection*{\KLUDGE 基本機能}

\KLUDGE 描画時のお決まりの処理です．
\ref{sec_grscene}\KLUDGE 節を参照してください．

\begin{center}
\begin{tabular}{p{.1\hsize}p{.45\hsize}p{.35\hsize}}
\multicolumn{2}{l}{\texttt{GRRenderIf}}									\\ \midrule
\texttt{void} & \texttt{GetClearColor(Vec4f\&)}			& \KLUDGE 背景色の取得				\\
\texttt{void} & \texttt{SetClearColor(const Vec4f\&)}	& \KLUDGE 背景色の設定				\\
\texttt{void} & \texttt{ClearBuffer()}					& \KLUDGE 描画バッファをクリア		\\
\texttt{void} & \texttt{BeginScene()}					& \KLUDGE 描画の開始				\\
\texttt{void} & \texttt{EndScene()}						& \KLUDGE 描画の完了				\\
\texttt{void} & \texttt{SwapBuffers()}					& \KLUDGE 描画バッファのスワップ	\\
\end{tabular}
\end{center}

\subsection*{\KLUDGE ディスプレイリスト}

\KLUDGE ディスプレイリストに関係する機能です．
\texttt{GRMesh}\KLUDGE が内部で使用します．

\begin{center}
\begin{tabular}{p{.1\hsize}p{.45\hsize}p{.35\hsize}}
\multicolumn{2}{l}{\texttt{GRRenderIf}}					\\ \midrule
\texttt{int}  & \texttt{StartList()}			& \KLUDGE ディスプレイリスト作成開始	\\
\texttt{void} & \texttt{EndList()}				& \KLUDGE ディスプレイリスト作成完了	\\
\texttt{void} & \texttt{DrawList(int)}			& \KLUDGE ディスプレイリストの描画		\\
\texttt{void} & \texttt{ReleaseList(int)}		& \KLUDGE ディスプレイリストの解放		\\
\end{tabular}
\end{center}

\subsection*{\KLUDGE デプステスト，アルファブレンディング，ライティング}

\KLUDGE 描画機能を切り替えるための関数です．

\begin{center}
\begin{tabular}{p{.1\hsize}p{.4\hsize}p{.4\hsize}}
\texttt{GRRenderIf}									&										\\ \midrule
\texttt{void} & \texttt{SetDepthWrite(bool)}					& \KLUDGE デプスバッファへの書き込みOn/Off		\\
\texttt{void} & \texttt{SetDepthTest(bool)}						& \KLUDGE デプステストのOn/Off					\\
\texttt{void} & \texttt{SetDepthFunc(TDepthFunc)}				& \KLUDGE デプスバッファの判定条件				\\
\texttt{void} & \texttt{SetAlphaTest(bool)}						& \KLUDGE アルファブレンディングのOn/Off		\\
\texttt{void} & \texttt{SetAlphaMode(TBlendFunc, TBlendFunc)}	& \KLUDGE アルファブレンディングのモード		\\
\texttt{void} & \texttt{SetLighting(bool)}						& \KLUDGE ライティングのOn/Off					\\
\end{tabular}
\end{center}

\subsection*{\KLUDGE テクスチャ}

\begin{center}
\begin{tabular}{p{.15\hsize}p{.45\hsize}p{.3\hsize}}
\texttt{GRRenderIf}														&						\\ \midrule
\texttt{int} 	& \texttt{LoadTexture(UTString)}										& \KLUDGE テクスチャのロード	\\
\texttt{void} 	& \texttt{SetTextureImage(UTString, int, int, int, int, char*)}		& \KLUDGE テクスチャの設定		\\
\end{tabular}
\end{center}

\subsection*{\KLUDGE シェーダ}

\begin{center}
\begin{tabular}{p{.15\hsize}p{.4\hsize}p{.35\hsize}}
\texttt{GRRenderIf}												&								\\ \midrule
\texttt{void} 		& \texttt{InitShader()}										& \KLUDGE シェーダの初期化				\\
\texttt{void} 		& \texttt{SetShaderFormat(ShaderType)}						& \KLUDGE シェーダフォーマットの設定	\\
\texttt{bool} 		& \texttt{CreateShader(UTString, UTString, GRHandler\&)}	& \KLUDGE シェーダオブジェクトの作成	\\
\texttt{GRHandler} 	& \texttt{CreateShader()}									& \KLUDGE シェーダオブジェクトの作成	\\
\texttt{bool} 		& \texttt{ReadShaderSource(GRHandler, UTString)}			& \KLUDGE シェーダプログラムをロード	\\
\texttt{void} 		& \texttt{GetShaderLocation(GRHandler, void*)}				& \KLUDGE ロケーション情報の取得		\\
\end{tabular}
\end{center}

\subsection*{\KLUDGE 直接描画}

\begin{center}
\begin{tabular}{p{.1\hsize}p{.45\hsize}p{.35\hsize}}
\texttt{GRRenderIf}																\\ \midrule
\texttt{void} & \texttt{SetVertexFormat(const GRVertexElement*)}							& \KLUDGE 頂点フォーマットの指定	\\
\texttt{void} & \texttt{SetVertexShader(void*)}											& \KLUDGE 頂点シェーダーの指定		\\
\texttt{void} & \texttt{DrawDirect(TPrimitiveType, void*, size\_t, size\_t)}				& \KLUDGE 頂点を指定してプリミティブを描画	\\
\texttt{void} & \texttt{DrawIndexed(TPrimitiveType, size\_t*, void*, size\_t, size\_t)}	& \KLUDGE 頂点とインデックスを指定してプリミティブを描画	\\
\texttt{void} & \texttt{DrawArrays(TPrimitiveType, GRVertexArray*, size\_t)}				& \KLUDGE 頂点の成分ごとの配列を指定して，プリミティブを描画	\\
\texttt{void} & \texttt{DrawArrays(TPrimitiveType, size\_t*, GRVertexArray*, size\_t)}		& \KLUDGE インデックスと頂点の成分ごとの配列を指定して，プリミティブを描画	\\
\end{tabular}
\end{center}

\subsection*{\KLUDGE 基本形状描画}

\begin{center}
\begin{tabular}{p{.1\hsize}p{.5\hsize}p{.3\hsize}}
\texttt{GRRenderIf}																					\\ \midrule
\texttt{void} & \texttt{DrawLine(Vec3f, Vec3f)}											& \KLUDGE 線分を描画	\\
\texttt{void} & \texttt{DrawArrow(Vec3f, Vec3f, float, float, float, int, bool)}			& \KLUDGE 矢印を描画	\\
\texttt{void} & \texttt{DrawBox(float, float, float, bool)}								& \KLUDGE 直方体を描画	\\
\texttt{void} & \texttt{DrawSphere(float, int, int, bool)}									& \KLUDGE 球体を描画	\\
\texttt{void} & \texttt{DrawCone(float, float, int, bool)}									& \KLUDGE 円錐の描画	\\
\texttt{void} & \texttt{DrawCylinder(float, float, int, bool)}								& \KLUDGE 円筒の描画	\\
\texttt{void} & \texttt{DrawCapsule(float, float, int, bool)}								& \KLUDGE カプセルの描画	\\
\texttt{void} & \texttt{DrawRoundCone(float, float, float, int, bool)}						& \KLUDGE 球円錐の描画	\\
\texttt{void} & \texttt{DrawGrid(float, int, float)}										& \KLUDGE グリッドを描画	\\
\texttt{void} & \texttt{SetFont(const GRFont\&)}											& \KLUDGE フォントの設定	\\
\texttt{void} & \texttt{DrawFont(Vec2f, UTString)}											& 2\KLUDGE 次元テキストの描画	\\
\texttt{void} & \texttt{DrawFont(Vec3f, UTString)}											& 3\KLUDGE 次元テキストの描画	\\
\texttt{void} & \texttt{SetLineWidth(float)}												& \KLUDGE 線の太さの設定	\\
\end{tabular}
\end{center}

\subsection*{\KLUDGE カメラ}

\begin{center}
\begin{tabular}{p{.27\hsize}p{.45\hsize}p{.18\hsize}}
\texttt{GRRenderIf}												\\ \midrule
\texttt{void} 					& \texttt{SetCamera(const GRCameraDesc\&)}	& \KLUDGE カメラの設定	\\
\texttt{const GRCameraDesc\&} 	& \texttt{GetCamera()}						& \KLUDGE カメラの取得	\\
\end{tabular}
\end{center}

\subsection*{\KLUDGE ライト}

\begin{center}
\begin{tabular}{p{.1\hsize}p{.45\hsize}p{.35\hsize}}
\texttt{GRRenderIf}													\\ \midrule
\texttt{void} & \texttt{PushLight(const GRLightDesc\&)}	& \KLUDGE ライトをプッシュ	\\
\texttt{void} & \texttt{PushLight(const GRLightIf*)}	& \KLUDGE ライトをプッシュ	\\
\texttt{void} & \texttt{PopLight()}						& \KLUDGE ライトをポップ	\\
\texttt{int}  & \texttt{NLights()}						& \KLUDGE ライトの数		\\
\end{tabular}
\end{center}

\subsection*{\KLUDGE 座標変換}

\begin{center}
\begin{tabular}{p{.1\hsize}p{.45\hsize}p{.35\hsize}}
\texttt{GRRenderIf}												\\ \midrule
\texttt{void} 	& \texttt{Reshape(Vec2f, Vec2f)}					& \KLUDGE ウィンドウサイズの変更				\\
\texttt{void} 	& \texttt{SetViewport(Vec2f, Vec2f)}				& \KLUDGE ビューポートの設定					\\
\texttt{Vec2f} 	& \texttt{GetViewportPos()}							& \KLUDGE ビューポート原点の取得				\\
\texttt{Vec2f} 	& \texttt{GetViewportSize()}						& \KLUDGE ビューポートサイズの取得				\\
\texttt{Vec2f} 	& \texttt{GetPixelSize()}							& 1\KLUDGE ピクセルの物理サイズを取得			\\
\texttt{Vec3f}	& \texttt{ScreenToCamera(int, int, float, bool)}	& \KLUDGE スクリーン座標からカメラ座標への変換	\\
\texttt{void} 	& \texttt{EnterScreenCoordinate()}					& \KLUDGE スクリーン座標系へ切り替える			\\
\texttt{void} 	& \texttt{LeaveScreenCoordinate()}					& \KLUDGE スクリーン座標系から戻る				\\
\end{tabular}
\end{center}

\begin{center}
\begin{tabular}{p{.1\hsize}p{.5\hsize}p{.3\hsize}}
\texttt{GRRenderIf}	& & 										\\ \midrule
\texttt{void} & \texttt{SetViewMatrix(const Affinef\&)}			& \KLUDGE 視点行列の設定	\\
\texttt{void} & \texttt{GetViewMatrix(Affinef\&)}				& \KLUDGE 視点行列の取得	\\
\texttt{void} & \texttt{SetProjectionMatrix(const Affinef\&)}	& \KLUDGE 投影行列の設定	\\
\texttt{void} & \texttt{GetProjectionMatrix(Affinef\&)}			& \KLUDGE 投影行列の取得	\\
\texttt{void} & \texttt{SetModelMatrix(const Affinef\&)}		& \KLUDGE モデル行列の設定	\\
\texttt{void} & \texttt{GetModelMatrix(Affinef\&)}				& \KLUDGE モデル行列の取得	\\
\texttt{void} & \texttt{MultModelMatrix(const Affinef\&)}		& \KLUDGE モデル行列に変換をかける	\\
\texttt{void} & \texttt{PushModelMatrix()}						& \KLUDGE モデル行列をプッシュ	\\
\texttt{void} & \texttt{PopModelMatrix()}						& \KLUDGE モデル行列をポップ	\\
\texttt{void} & \texttt{ClearBlendMatrix()}						& \KLUDGE ブレンド変換行列のクリア	\\
\texttt{bool} & \texttt{SetBlendMatrix(const Affinef\&, int)}	& \KLUDGE ブレンド変換行列の設定	\\
\end{tabular}
\end{center}

